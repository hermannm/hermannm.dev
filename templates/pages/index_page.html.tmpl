<!doctype html>
<html lang="en-US">
{{ template "head.html.tmpl" .Meta -}}
<body
    class="mb-4 mx-auto px-2 mt-4 flex min-h-(--page-height) max-w-(--index-page-width) flex-col gap-4 bg-gruvbox-bg0 text-gruvbox-fg"
>
<div class="flex flex-col items-center gap-4 xs:flex-row">
  <div
      class="flex flex-col gap-4 xs:min-w-(--xs-to-sm-about-me-width) xs:max-w-(--xs-to-sm-about-me-width) sm:min-w-0 sm:max-w-none"
  >
    <h1 class="m-0 flex flex-row justify-center text-3xl font-bold">{{ .Meta.Page.Title }}</h1>
    <!-- Extensive media queries to get desired line breaks at certain widths -->
    <p class="mb-0 mt-0 pl-1 xs:pr-1 min-[1006px]:pr-2 min-[1010px]:pr-3 min-[1014px]:pr-4 min-[1018px]:pr-6">
      {{ .AboutMe }}
    </p>
    <ul
        class="mb-0 mt-0 grid list-none grid-cols-2 place-items-center gap-4 pl-0 md:grid-cols-4"
    >
      {{- range $infoField := .PersonalInfo }}
        {{- if $infoField.Link }}
          <li>
            <a class="flex items-center gap-2" href="{{ $infoField.Link }}" target="_blank">
              <div class="flex h-4 w-4 items-center justify-center" aria-hidden="true">
                {{ $infoField.Icon }}
              </div>
              <div class="w-min text-center">
                {{ personalInfoTextWrapping $infoField.LinkText }}
              </div>
            </a>
          </li>
        {{- else }}
          <li class="flex items-center gap-2">
            <div class="flex h-4 w-4 items-center justify-center" aria-hidden="true">
              {{ $infoField.Icon }}
            </div>
            <div class="w-min text-center">
              {{ personalInfoTextWrapping $infoField.LinkText }}
            </div>
          </li>
        {{ end -}}
      {{ end }}
    </ul>
  </div>
  <div>
    <picture>
      <source
          media="(max-width: 479px)"
          width="{{ .ProfilePictureMobile.Width }}"
          height="{{ .ProfilePictureMobile.Height }}"
          srcset="{{ .ProfilePictureMobile.Path }}"
      />
      <source
          media="(min-width: 480px)"
          width="{{ .ProfilePictureDesktop.Width }}"
          height="{{ .ProfilePictureDesktop.Height }}"
          srcset="{{ .ProfilePictureDesktop.Path }}"
      />
      <img
          class="h-full w-full rounded-lg border-2 border-solid border-gruvbox-bg2 xs:h-(--profile-pic-size) xs:max-w-full xs:object-cover sm:w-(--profile-pic-size) sm:max-w-none"
          src="{{ .ProfilePictureDesktop.Path }}"
          alt="{{ .ProfilePictureDesktop.Alt }}"
      />
    </picture>
  </div>
</div>

{{ $defaultProjectGroup := index .ProjectGroups 0 }}

<ul class="tabs">
  {{ range $projectGroup := .ProjectGroups }}
    <li
        id="{{ $projectGroup.Slug }}-tab"
        class="{{ if eq $projectGroup.Slug $defaultProjectGroup.Slug }}active{{ end }}"
    >
      <a href="{{ if eq $projectGroup.Slug $defaultProjectGroup.Slug }}#{{ else }}#{{ $projectGroup.Slug }}{{ end }}">{{ $projectGroup.Title }}</a>
    </li>
  {{ end }}
</ul>

{{ range $projectGroup := .ProjectGroups }}
  <div id="{{ $projectGroup.Slug }}-content"
       class="flex flex-col gap-4 {{ if ne $projectGroup.Slug $defaultProjectGroup.Slug }}hidden{{ end }} {{ if not $projectGroup.IntroText }}mt-3{{ end }}">
    {{ if $projectGroup.IntroText -}}
      <div class="flex justify-center mb-2">
        <p class="max-w-204 text-center">{{ $projectGroup.IntroText }}</p>
      </div>
    {{- end }}

    <ul class="m-0 flex list-none flex-wrap justify-center gap-6 pl-0">
      {{- range $project := $projectGroup.Projects }}
        <li
            class="md-lg:basis-[calc(100%/3-1rem)] basis-full rounded-lg border-2 border-solid border-gruvbox-bg2 duration-100 lift-on-hover sm:basis-[calc(50%-0.75rem)]"
        >
          <a class="flex h-full flex-col items-center no-underline" href="{{ $project.Path }}">
            <div class="half-border-background w-full pb-1 pt-1">
              {{ if $project.Logo.Path }}
                <img
                    class="mx-auto max-w-[60px] rounded-lg"
                    width="60"
                    height="60"
                    src="{{ $project.Logo.Path }}"
                    alt="{{ $project.Logo.AltText }}"
                />
              {{ else }}
                <div class="mx-auto h-[40px] flex justify-center">
                  {{ $project.IndexPageFallbackIcon }}
                </div>
              {{ end }}
            </div>
            <div class="flex grow flex-col items-center gap-1 pb-2 pl-2 pr-2 text-center">
              <h3 class="text-lg font-bold">{{ $project.Name }}</h3>
              <p class="flex min-h-12 grow items-center no-underline">
                {{ $project.TagLine }}
              </p>
            </div>
          </a>
        </li>
      {{- end }}
    </ul>
  </div>
{{ end }}

{{ template "footer.html.tmpl" .Meta.Common }}

<script>
  const defaultProjectGroupHash = "{{ $defaultProjectGroup.Slug }}";

  // If page is loaded with a hash, switch to that tab
  selectTabFromURLHash({
    oldHash: defaultProjectGroupHash,
    newHash: location.hash?.replace("#", "") || defaultProjectGroupHash
  });

  // Whenever hash changes, switch tab
  window.addEventListener("hashchange", (event) => {
    const oldURL = new URL(event.oldURL);
    const newURL = new URL(event.newURL);

    selectTabFromURLHash({
      oldHash: oldURL.hash?.replace("#", "") || defaultProjectGroupHash,
      newHash: newURL.hash?.replace("#", "") || defaultProjectGroupHash
    });

    // The default tab will have hash '#', but we don't want to show that in the URL
    if (!newURL.hash || newURL.hash === "#") {
      window.history.replaceState({}, "", newURL.toString().replace("#", ""));
    }
  });

  /**
   * @param {Object} args
   * @param {string} args.oldHash
   * @param {string} args.newHash
   */
  function selectTabFromURLHash({ oldHash, newHash }) {
    if (newHash === oldHash) {
      return;
    }

    const oldTab = document.getElementById(`${oldHash}-tab`);
    const newTab = document.getElementById(`${newHash}-tab`);
    const oldContent = document.getElementById(`${oldHash}-content`);
    const newContent = document.getElementById(`${newHash}-content`);

    newTab.classList.add("active");
    oldTab.classList.remove("active");
    newContent.classList.remove("hidden");
    oldContent.classList.add("hidden");
  }
</script>
</body>
</html>
